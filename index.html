<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <div id="ai-chatbot-container" class="chatbot">
        <div id="ai-chat-messages" class="messages"></div>
        <form id="ai-chat-form">
            <input type="text" id="ai-chat-input" placeholder="Digite sua mensagem..." required>
            <button type="submit">Enviar</button>
        </form>
    </div>

    <script>
        // Função para alternar a abertura/fechamento do chatbot
        function toggleChatbot() {
            const bot = document.getElementById('ai-chatbot-container');
            if(bot.classList.contains('open')) {
                bot.classList.remove('open');
            } else {
                bot.classList.add('open');
                document.getElementById('ai-chat-input').focus();
            }
        }

        // Função auxiliar para adicionar mensagem ao chat visualmente
        function addChatMessage(author, text) {
            const messageBox = document.getElementById('ai-chat-messages');
            const msgDiv = document.createElement('div');
            msgDiv.style.marginBottom = '12px';
            msgDiv.style.display = 'flex';
            msgDiv.style.justifyContent = author === 'user' ? 'flex-end' : 'flex-start';

            const bubble = document.createElement('div');
            bubble.textContent = text;
            bubble.style.padding = '8px 14px';
            bubble.style.borderRadius = '18px';
            bubble.style.maxWidth = '75%';
            bubble.style.wordBreak = 'break-word';
            bubble.style.background = author === 'user' ? '#0D47A1' : '#f3f3f3';
            bubble.style.color = author === 'user' ? '#fff' : '#222';
            bubble.style.fontSize = '15px';
            bubble.style.boxShadow = '0 2px 8px rgba(0,0,0,0.08)';

            msgDiv.appendChild(bubble);
            messageBox.appendChild(msgDiv);
            messageBox.scrollTop = messageBox.scrollHeight;
        }

        // Troque pela URL do seu backend IA
        const BACKEND_URL = "https://SEU_BACKEND_EXEMPLO.com/api/chatbot";
        
        // Função para buscar resposta real no backend de IA
        async function getRealResponse(message) {
            try {
                const response = await fetch(BACKEND_URL, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ question: message })
                });
                if(!response.ok) throw new Error("Erro ao consultar IA");
                const data = await response.json();
                return data.reply || "A IA não retornou resposta.";
            } catch (err) {
                return "Erro ao conectar ao assistente IA. Tente novamente.";
            }
        }

        // Gerenciamento do formulário de chat
        const chatForm = document.getElementById('ai-chat-form');
        if(chatForm) {
            chatForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                const input = document.getElementById('ai-chat-input');
                const userMsg = input.value.trim();
                if(!userMsg) return;
                addChatMessage('user', userMsg);
                input.value = '';
                addChatMessage('bot', 'Digitando...');
                const reply = await getRealResponse(userMsg);
                // Remove o "Digitando..."
                const msgBox = document.getElementById('ai-chat-messages');
                msgBox.removeChild(msgBox.lastChild);
                addChatMessage('bot', reply);
            });
        }

        // Fecha o chatbot ao pressionar ESC
        window.addEventListener('keydown', function(e){
            if(e.key === 'Escape') {
                document.getElementById('ai-chatbot-container').classList.remove('open');
            }
        });
    </script>
</body>
</html>
